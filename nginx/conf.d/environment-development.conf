# Development environment specific configuration

# Additional server for development tools
server {
    listen 8082;  # REVERSE_PROXY_PORT for development
    server_name localhost;
    
    # Development API gateway with enhanced logging
    access_log /var/log/nginx/development-api.log main;
    
    location / {
        return 200 "Aletheia Development API Gateway\n";
        add_header Content-Type text/plain;
    }
    
    # Direct service access for debugging
    location /debug/n8n/ {
        rewrite ^/debug/n8n/(.*)$ /$1 break;
        proxy_pass http://n8n:5678;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    location /debug/chat/ {
        rewrite ^/debug/chat/(.*)$ /$1 break;
        proxy_pass http://lawyer-chat:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    location /debug/portal/ {
        rewrite ^/debug/portal/(.*)$ /$1 break;
        proxy_pass http://ai-portal:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # Service status endpoint
    location /status {
        access_log off;
        return 200 '{"environment":"development","services":["n8n","lawyer-chat","ai-portal","haystack"]}\n';
        add_header Content-Type application/json;
    }
}